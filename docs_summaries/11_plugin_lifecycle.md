# Halo 插件生命周期 (Lifecycle)

插件的生命周期由 Halo 核心通过 PF4J 进行管理。

## 1. 核心类 `BasePlugin`
所有插件的入口类必须继承 `run.halo.app.plugin.BasePlugin`。

## 2. 关键方法

### `start()`
*   **触发时机**: 插件被加载并启用时（Halo 启动时或手动启用时）。
*   **作用**: 进行初始化操作。
*   **注意**: 
    *   此时 Spring 上下文已准备就绪。
    *   **重要**: 不要在 `start` 中进行耗时操作，否则会阻塞 Halo 启动。
    *   **推荐操作**: 可以在此注册一些非 Spring 管理的监听器或进行简单的状态检查。但在 Halo 2.0+ 中，大多数初始化逻辑应通过 Spring Bean 的生命周期（`@PostConstruct`, `SmartLifecycle`）或 Reconciler 来自动处理，而**不再严重依赖 `start()`**。

### `stop()`
*   **触发时机**: 插件被禁用或 Halo 关闭时。
*   **作用**: 释放资源。
*   **责任**: 必须清理在 `start()` 中创建的线程、定时任务或非托管资源，防止内存泄漏。

### `delete()`
*   **触发时机**: 插件被卸载时。
*   **作用**: 清理持久化数据（如删除插件创建的配置文件、临时文件等）。
*   **注意**: 默认情况下，插件卸载**不会**自动删除该插件定义的 Custom Resource (Extension) 数据，如果需要彻底清理，需在此方法中显式调用 API 进行删除。

## 3. 最佳实践 (Halo 2.x)
在 Halo 2.x 架构中，推荐使用 **Reconciler (协调器)** 来管理业务逻辑的生命周期，而不是过度依赖 `BasePlugin` 的生命周期方法。`BasePlugin` 更多用于处理插件自身的元数据状态。
